import{d as D,m as b,U as M,u as a,r as $,k,h as H,n,c as h,a as e,g as p,t as V,b as s,K as y,w as r,F as K,p as j,q as L,e as q,s as A,o as i,f as O,v as G,x as B,y as J,z as P,i as E,j as Q,A as R,E as W,l as X,_ as Y}from"./index-5NSRsizs.js";const u=_=>(J("data-v-45c39d2e"),_=_(),P(),_),Z={key:0,class:"userInfo"},ee={class:"info-left"},le=u(()=>e("span",null,null,-1)),ae=["src"],te=u(()=>e("span",null,"昵称:",-1)),oe=u(()=>e("p",null,[e("span",null,"角色:"),e("span",null,"User")],-1)),ne=u(()=>e("span",null,null,-1)),se=u(()=>e("span",null,null,-1)),re={class:"info-right"},de=["placeholder","onUpdate:modelValue"],ie=u(()=>e("div",{class:"dialog-header"},[e("h3",null,"修改资料")],-1)),ue={class:"dialog-content"},ce=["src"],me=["accept"],pe={class:"dialog-footer"},_e=D({__name:"UserView",setup(_){const v=b([{id:0,val:"",key:"",placeholder:""}]),f=b(),U=b(new M({action:"/upload/upload",onSuccess:(t,l)=>{l||(a.member.avatar=t.data.file,a.member.image=t.data.url)},onFinished:()=>{}})),w=async t=>{var g;(g=f.value)==null||g.removeEventListener("change",w);const l=t.target.files;if(l)for(let d=0;d<l.length;d++){const m=l.item(d);await U.value.startUpload(m)}},C=()=>{var t,l;(t=f.value)==null||t.addEventListener("change",w),(l=f.value)==null||l.click()},c=$({isEditTag:!1}),F=()=>{k.put("/member/update",a.member).then(t=>{a.actions.setMember(t.data)}).catch(t=>{E.error(t.message)}).finally(()=>{c.isEditTag=!1})},S=t=>{k.put("/auth/updateConfig",v.value[t]).then(()=>{E.success("修改成功")}).catch(()=>{E.error("修改失败")})};return k.get("/auth/config").then(t=>{v.value=t.data}).catch(()=>{H.replace("/login")}),(t,l)=>{const g=q("router-link"),d=Q,m=R,z=W,I=X,N=A;return n(a).isLogin?(i(),h("div",Z,[e("div",ee,[e("p",null,[le,p(),e("img",{src:n(a).member.image,alt:""},null,8,ae)]),e("p",null,[te,p(),e("span",null,V(n(a).member.name),1)]),oe,e("p",null,[ne,e("span",null,V(n(a).member.lastLoginTime),1)]),e("p",null,[se,e("span",null,V(n(a).member.lastLoginIp),1)]),e("p",null,[e("span",null,[s(y,{onClick:l[0]||(l[0]=o=>c.isEditTag=!0),name:"edit",size:"1.5rem",color:"#cccccce6"})]),e("span",null,[s(g,{to:"/"},{default:r(()=>[p("首页")]),_:1})])])]),e("div",re,[e("ul",null,[(i(!0),h(K,null,j(v.value,(o,x)=>(i(),h("li",{key:x},[O(e("input",{placeholder:o.placeholder,"onUpdate:modelValue":T=>o.val=T},null,8,de),[[G,o.val]]),o.val.length>0?(i(),B(y,{key:0,name:"submit",style:{"margin-right":"10px"},size:"1.5rem",color:"#0e9ce1",onClick:T=>S(x)},null,8,["onClick"])):L("",!0)]))),128))])]),s(N,{"append-to-body":"",title:"提示","show-close":!1,modelValue:c.isEditTag,"onUpdate:modelValue":l[5]||(l[5]=o=>c.isEditTag=o),width:"500",draggable:!0,"lock-scroll":!1,"modal-class":"kan-dialog"},{header:r(()=>[ie]),default:r(()=>[e("div",ue,[s(z,null,{default:r(()=>[s(d,{label:"头像"},{default:r(()=>[n(a).member.image?(i(),h("img",{key:0,class:"avatar",alt:"头像",onClick:C,style:{cursor:"pointer"},src:n(a).member.image},null,8,ce)):(i(),B(y,{key:1,onClick:C,name:"image",size:"50px",color:"#17b97d"})),e("input",{type:"file",accept:U.value.allowExt,ref_key:"uploadHtmlInput",ref:f,hidden:"hidden"},null,8,me)]),_:1}),s(d,{label:"账号"},{default:r(()=>[s(m,{modelValue:n(a).member.username,"onUpdate:modelValue":l[1]||(l[1]=o=>n(a).member.username=o),placeholder:"账号"},null,8,["modelValue"])]),_:1}),s(d,{label:"密码"},{default:r(()=>[s(m,{modelValue:n(a).member.password,"onUpdate:modelValue":l[2]||(l[2]=o=>n(a).member.password=o),placeholder:"密码"},null,8,["modelValue"])]),_:1}),s(d,{label:"昵称"},{default:r(()=>[s(m,{modelValue:n(a).member.name,"onUpdate:modelValue":l[3]||(l[3]=o=>n(a).member.name=o),placeholder:"昵称"},null,8,["modelValue"])]),_:1})]),_:1})])]),footer:r(()=>[e("div",pe,[s(I,{type:"danger",onClick:l[4]||(l[4]=o=>c.isEditTag=!1)},{default:r(()=>[p("取消")]),_:1}),s(I,{type:"primary",onClick:F},{default:r(()=>[p("确定")]),_:1})])]),_:1},8,["modelValue"])])):L("",!0)}}}),ge=Y(_e,[["__scopeId","data-v-45c39d2e"]]);export{ge as default};
